<!DOCTYPE html>
<body>
    <meta charset="UTF-8" />
    <title>WikiHop</title>
    <link rel="stylesheet" href="css/style.css" />

    <div id="game-container">
        <aside id="sidebar">
            <h2 id="home-btn">WikiHop</h2>
            <p><strong id="click-counter-label">Clicks:</strong> <span id="click-counter">0</span></p>
            <p><strong id="start-page-label">Start:</strong> <span id="start-page">Loading...</span></p>
            <p><strong id="target-page-label">Target:</strong> <span id="target-page">Loading...</span></p>
        </aside>
        <div id="target-tooltip" class="tooltip hidden"></div>
        <main id="main-content">
            <header>
                <h1 id="page-title">Loading...</h1>
            </header>
            <div id="content"></div>
        </main>
    </div>

    <div id="start-modal">
        <div id="start-box">
            <h2 id="start-header">WikiHop</h2>
            <p>Choose your start and target pages</p>

            <form id="start-form">
                <label for="wiki-lang">Wikipedia language</label>
                <select id="wiki-lang">
                    <option value="en" selected>English</option>
                    <option value="fi">Finnish</option>
                    <option value="de">German</option>
                    <option value="sv">Swedish</option>
                </select>
                <br>
                <label for="gamemode">Game Mode:</label>
                <select id="gamemode">
                    <option value="set">Set Run</option>
                    <option value="random">Random</option>
                    <option value="timed">Time Attack</option>
                </select>
                <br>
                <label for="start-menu">Start Page:</label>
                <br>
                <input type="text" id="start-menu" placeholder="e.g., Finland" />
                <br>
                <label for="target-menu">Target Page:</label>
                <input type="text" id="target-menu" placeholder="e.g., Pakkala" />

                <button id="start-game-btn">Start Game</button>
            </form>
            <br>
            <button id="create-party-btn">Create Party</button>
            <button id="join-party-btn">Join Party</button>
            <br>
            <div id="party-lobby-modal" class="hidden">
                <p>Your party code: <span id="party-code"></span></p>
                <label for="party-gamemode">Game Mode:</label>
                <select id="party-gamemode">
                    <option value="teamwork">Teamwork</option>
                    <option value="competition">Competition</option>
                </select>
                <br>
            </div>
        </div>
    </div>

    <div id="win-modal" class="hidden">
        <div id="win-box">
            <h2>You reached the target!</h2>
            <p>Clicks: <span id="final-clicks">0</span></p>
            <p>Time: <span id="final-time">0</span></p>
            <button id="new-round-btn">Start New Round</button>
        </div>
    </div>

    <!-- Firebase -->
    <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAW2ZuYIJdPXQVyYnHYqS3ZdHa5OIEI9b4",
        authDomain: "wikihop-game.firebaseapp.com",
        projectId: "wikihop-game",
        storageBucket: "wikihop-game.firebasestorage.app",
        messagingSenderId: "287351342114",
        appId: "1:287351342114:web:cde2b5e285ccb81ede767b",
        measurementId: "G-YH7NT8DZSZ"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.saveRandomScore = async function({
        player,
        clicks,
        timeMs,
        startPage,
        targetPage
    }) {
        await addDoc(collection(db, "leaderboard_random"), {
        player,
        clicks,
        timeMs,
        startPage,
        targetPage,
        date: new Date()
        });
    }

    window.getRandomLeaderboard = async function() {
        const q = query(collection(db, "leaderboard_random"), orderBy("clicks", "asc"), limit(10));
        const snapshot = await getDocs(q);
        return snapshot.docs.map(doc => doc.data());
    }
    </script>

    <!-- Javascript -->
    <script type="module" src="js/multiplayer.js"></script>
    <script src="js/api.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/game.js"></script>
    <script src="js/langs.js"></script>
</body>