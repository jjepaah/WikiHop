<!DOCTYPE html>
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WikiHop</title>
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/mobile.css" />
</head>
<body>

    <div id="game-container">
        <aside id="sidebar">
            <h2 id="home-btn">WikiHop</h2>
            <p><strong id="click-counter-label">Clicks:</strong> <span id="click-counter">0</span></p>
            <p id="timer-display" class="hidden"><strong id="timer-label">Time:</strong> <span id="timer">0.00s</span></p>
            <p><strong id="start-page-label">Start:</strong> <span id="start-page">Loading...</span></p>
            <div id="target-page-wrapper">
                <p><strong id="target-page-label">Target:</strong> <span id="target-page">Loading...</span></p>
                <div id="target-tooltip" class="target-info collapsed"></div>
            </div>
            
            <!-- Rogue Mode Stats -->
            <div id="rogue-stats" class="hidden">
                <hr>
                <p><strong>Stage:</strong> <span id="rogue-stage">1</span></p>
                <p><strong>Score:</strong> <span id="rogue-score">0</span> (<span id="rogue-wikipoints">0</span> WP)</p>
                <div id="rogue-modifiers">
                    <strong>Modifiers:</strong>
                    <ul id="rogue-modifier-list"><li>None</li></ul>
                </div>
                <div id="rogue-items">
                    <strong>Items:</strong>
                    <ul id="rogue-item-list"><li>None</li></ul>
                </div>
            </div>
            
            <!-- Developer Controls -->
            <div id="dev-controls" class="hidden">
                <hr>
                <p><strong style="color: #ff6b6b;">DEV MODE</strong></p>
                <input type="text" id="dev-target-input" placeholder="Change target..." style="width: 100%; padding: 0.4rem; border-radius: 4px; border: 1px solid #555; background: #2a2a2a; color: #e0e0e0; font-size: 0.85rem;" />
                <small style="color: #888; font-size: 0.75rem;">Press Enter to change target</small>
            </div>
        </aside>
        <main id="main-content">
            <header>
                <h1 id="page-title">Loading...</h1>
            </header>
            <div id="content"></div>
        </main>
    </div>

    <div id="start-modal">
        <div id="start-box">
            <h1 id="start-header">WikiHop</h1>
            
            <div id="auth-section">
                <!-- Registration Form -->
                <div id="register-form" class="hidden">
                    <h3>Create Account</h3>
                    <div class="auth-form">
                        <input type="text" id="register-username" placeholder="Username (3-20 characters)" maxlength="20" />
                        <input type="password" id="register-password" placeholder="Password (min 6 characters)" />
                        <input type="password" id="register-confirm-password" placeholder="Confirm Password" />
                        <button id="register-submit-btn" type="button">Create Account</button>
                        <p id="register-error" class="error-message hidden"></p>
                    </div>
                    <p class="auth-toggle">Already have an account? <a href="#" id="show-login-btn">Login</a></p>
                </div>
                
                <!-- Login Form -->
                <div id="login-form">
                    <h3>Login</h3>
                    <div class="auth-form">
                        <input type="text" id="login-username" placeholder="Username" />
                        <input type="password" id="login-password" placeholder="Password" />
                        <button id="login-submit-btn" type="button">Login</button>
                        <p id="login-error" class="error-message hidden"></p>
                    </div>
                    <p class="auth-toggle">Don't have an account? <a href="#" id="show-register-btn">Create one</a></p>
                </div>
                
                <div class="guest-section">
                    <button id="play-as-guest-btn" type="button" class="guest-btn">Play as Guest</button>
                </div>
            </div>
            
            <div id="game-setup-section" class="hidden">
                <div class="user-info">
                    <p>Playing as: <strong id="current-username">Guest</strong></p>
                    <button id="logout-btn" type="button" class="small-btn">Logout</button>
                    <button id="signin-btn" type="button" class="small-btn signin-btn" style="display: none;">Sign in</button>
                </div>
            <p class="help-link-container"><a href="#" id="help-link">Help</a></p>

            <form id="start-form">
                <div class="dropdowns-container">
                    <div class="dropdown-section">
                        <label for="wiki-lang">Wikipedia language</label>
                        <select id="wiki-lang">
                            <option value="en" selected>English</option>
                            <option value="fi">Finnish</option>
                            <option value="de">German</option>
                            <option value="sv">Swedish</option>
                        </select>
                    </div>
                    <div class="dropdown-section">
                        <label for="gamemode">Game Mode:</label>
                        <select id="gamemode">
                            <option value="set">Set Run</option>
                            <option value="random" selected>Random</option>
                            <option value="timed">Time Attack</option>
                            <option value="rogue">Rogue (Beta)</option>
                        </select>
                    </div>
                </div>
                <div id="random-timed-section" class="random-timed-section" style="display: flex; align-items: center; justify-content: center; width: fit-content; margin: 0 auto;">
                    <input type="checkbox" id="random-timed-checkbox" style="margin: 0; padding: 0;" />
                    <label for="random-timed-checkbox" style="margin: 0; padding: 0; margin-left: 4px; white-space: nowrap; vertical-align: middle; line-height: 1;">Time Attack (5 min)</label>
                </div>
                <div id="time-limit-section" class="time-limit-section hidden">
                    <div class="dropdowns-container">
                        <div class="dropdown-section">
                            <label for="time-limit-preset">Time Limit:</label>
                            <select id="time-limit-preset">
                                <option value="standard" selected>Standard (5 min)</option>
                                <option value="custom">Custom</option>
                            </select>
                        </div>
                        <div class="dropdown-section" id="custom-time-input-wrapper" style="display: none;">
                            <label for="custom-time-input">Minutes:</label>
                            <input type="number" id="custom-time-input" placeholder="5" min="1" max="60" value="5" />
                        </div>
                    </div>
                </div>
                <div class="page-input-section">
                    <label for="start-menu">Start Page:</label>
                    <input type="text" id="start-menu" placeholder="e.g., Finland" />
                </div>
                <div class="page-input-section">
                    <label for="target-menu">Target Page:</label>
                    <input type="text" id="target-menu" placeholder="e.g., Pakkala" />
                </div>

                <button type="submit" id="start-game-btn">Start Game</button>
            </form>

            <div class="button-container">
                <button id="create-party-btn">Create Party</button>
                <button id="join-party-btn">Join Party</button>
            </div>
            <div id="party-lobby-modal" class="hidden">
                <div class="party-lobby-content">
                    <div class="party-info">
                        <p><strong>Party Code:</strong></p>
                        <p class="party-code-display"><span id="party-code"></span></p>
                    </div>

                    <div class="party-gamemode">
                        <label for="party-gamemode">Game Mode:</label>
                        <select id="party-gamemode">
                            <option value="teamwork">Teamwork</option>
                            <option value="competition">Competition</option>
                        </select>
                    </div>

                    <div class="party-buttons">
                        <!-- Buttons added dynamically by JavaScript -->
                    </div>
                </div>
            </div>
            </div>
            
        </div>
        <div id="leaderboard-box">
            <h2>Leaderboard</h2>
            <div class="leaderboard-tabs">
                <button class="leaderboard-tab active" data-mode="random">Random</button>
                <button class="leaderboard-tab" data-mode="timed">Timed</button>
            </div>
            <div id="leaderboard-content">
                <p>Loading leaderboard...</p>
            </div>
        </div>
    </div>

    <div id="win-modal" class="hidden">
        <div id="win-box">
            <h2 id="win-title">You reached the target!</h2>
            <p>Clicks: <span id="final-clicks">0</span></p>
            <p>Time: <span id="final-time">0</span></p>
            <button id="new-round-btn">Back to Menu</button>
        </div>
    </div>

    <!-- Rogue Mode: Stage Complete Modal -->
    <div id="stage-complete-modal" class="hidden">
        <div class="modal-box">
            <h2>Stage Complete!</h2>
            <p><strong>Stage:</strong> <span id="stage-complete-number">1</span></p>
            <p><strong>Clicks used:</strong> <span id="stage-clicks-used">0</span></p>
            <p><strong>Clicks remaining:</strong> <span id="stage-clicks-remaining">0</span></p>
            <p><strong>Clicks earned:</strong> +<span id="stage-clicks-earned">0</span></p>
            <p><strong>Score earned:</strong> +<span id="stage-score-earned">0</span></p>
            <button id="continue-stage-btn">Continue</button>
        </div>
    </div>

    <!-- Rogue Mode: Modifier Selection Modal -->
    <div id="modifier-selection-modal" class="hidden">
        <div class="modal-box">
            <h2>Choose Difficulty</h2>
            <p class="modifier-intro">Select how many modifiers to activate. More modifiers = more clicks earned!</p>
            <p><strong>Current clicks:</strong> <span id="modifier-clicks-display">0</span></p>
            <div id="modifier-options" class="modifier-options">
                <!-- Dynamically populated -->
            </div>
            <button id="confirm-modifiers-btn" class="primary-btn">Start Stage</button>
        </div>
    </div>

    <!-- Rogue Mode: Shop Modal -->
    <div id="shop-modal" class="hidden">
        <div class="modal-box">
            <h2>Shop</h2>
            <p class="shop-intro">Purchase items and upgrades to help you survive longer</p>
            <p><strong>Clicks available:</strong> <span id="shop-clicks-display">0</span></p>
            <div id="shop-items" class="shop-items">
                <!-- Dynamically populated -->
            </div>
            <div class="shop-actions">
                <button id="reroll-shop-btn" class="secondary-btn">Reroll (4 clicks)</button>
                <button id="close-shop-btn" class="primary-btn">Continue</button>
            </div>
        </div>
    </div>

    <!-- Firebase -->
    <script type="module" src="js/firestore.js"></script>

    <!-- Javascript -->
    <script type="module" src="js/auth.js"></script>
    <script type="module" src="js/core/leaderboard.js"></script>
    <script type="module" src="js/multiplayer.js"></script>
    <script src="js/api.js"></script>
    <script type="module" src="js/ui.js"></script>
    <script type="module" src="js/game.js"></script>
    <script src="js/langs.js"></script>
    
    <!-- Developer Mode (ignored by git) -->
    <script type="module">
        // Try to load dev mode if it exists
        try {
            const { initDevMode } = await import('./local/dev-mode.js');
            initDevMode();
        } catch (e) {
            // Dev mode file doesn't exist, silently ignore
        }
    </script>
</body>